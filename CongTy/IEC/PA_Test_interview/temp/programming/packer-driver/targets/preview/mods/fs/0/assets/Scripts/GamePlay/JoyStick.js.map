{"version":3,"sources":["file:///C:/Users/PC%20GM/Desktop/Jobs/WinterWolf_IEC/PA_Test_interview/assets/Scripts/GamePlay/JoyStick.ts"],"names":["_decorator","Component","Node","UITransform","Vec2","Vec3","GameInfo","BlackHole","ccclass","property","JoyStick","start","initProps","registerEvent","max_r","active","stick","node","on","EventType","TOUCH_START","touchStart","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","event","isCanTouch","isTouching","toggleJoystickUI","currentTouchPos","getLocalTouchPos","setPosition","bonceAnim","distance","clone","subtract","position","max_r_ratio","getComponent","width","length","normalize","multiplyScalar","add","radian","getRadian","result","PROJECT_DESIGN_WIDTH","PROJECT_DESIGN_HEIGHT","screenPos","getUILocation","x","y","z","directionVector","max_r_pos","getPosition","newPos","Math","atan2"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, EventTouch, log, Node, screen, Size, size, UITransform, Vec2, Vec3, view } from 'cc';\nimport { GameInfo } from '../CONST/GameInfo';\nimport { BlackHole } from './BlackHole';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = JoyStick\n * DateTime = Wed Jan 01 2025 10:19:33 GMT+0700 (Indochina Time)\n * Author = hoanghiep2001\n * FileBasename = JoyStick.ts\n * FileBasenameNoExtension = JoyStick\n * URL = db://assets/Scripts/GamePlay/JoyStick.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/en/\n *\n */\n\n@ccclass('JoyStick')\nexport class JoyStick extends Component {\n\n    @property(BlackHole)\n    BlackHole: BlackHole = null;\n\n    currentTouchPos: Vec3 = null;\n\n    @property(Node)\n    max_r: Node = null;\n    @property(Node)\n    stick: Node = null;\n\n\n    protected start(): void {\n        this.initProps();\n        this.registerEvent();\n    }\n\n\n    private initProps(): void {\n        this.max_r.active = false;\n        this.stick.active = false;\n    }\n\n\n    private registerEvent(): void {\n        this.node.on(Node.EventType.TOUCH_START, this.touchStart, this);\n        this.node.on(Node.EventType.TOUCH_MOVE, this.touchMove, this);\n        this.node.on(Node.EventType.TOUCH_END, this.touchEnd, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.touchEnd, this);\n    }\n\n\n    private touchStart(event: EventTouch): void {\n        if (!GameInfo.isCanTouch) return;\n\n        GameInfo.isTouching = true;\n\n        this.toggleJoystickUI();\n\n        this.currentTouchPos = this.getLocalTouchPos(event);\n\n        this.max_r.setPosition(this.currentTouchPos);\n\n        this.stick.setPosition(this.currentTouchPos);\n\n        this.BlackHole.bonceAnim();\n    }\n\n\n    private touchMove(event: EventTouch): void {\n        if (!GameInfo.isCanTouch) return;\n\n        this.currentTouchPos = this.getLocalTouchPos(event);\n\n        const distance = this.currentTouchPos.clone().subtract(this.max_r.position),\n            max_r_ratio = this.max_r.getComponent(UITransform).width / 2;\n\n        // convert stick to max_r ratio\n        if (distance.length() > max_r_ratio) {\n            distance.normalize().multiplyScalar(max_r_ratio);\n            this.currentTouchPos = this.max_r.position.clone().add(distance);\n        }\n\n        this.stick.setPosition(this.currentTouchPos);\n\n        this.BlackHole.radian = this.getRadian();\n\n    }\n\n\n    private touchEnd(): void {\n        GameInfo.isTouching = false;\n\n        this.toggleJoystickUI();\n    }\n\n\n    private toggleJoystickUI(): void {\n        this.max_r.active = !this.max_r.active;\n        this.stick.active = !this.stick.active;\n    }\n\n\n    private getLocalTouchPos(event: EventTouch): Vec3 {\n        let result = new Vec3();\n\n        const PROJECT_DESIGN_WIDTH: number = 320,\n            PROJECT_DESIGN_HEIGHT: number = 480,\n            screenPos = event.getUILocation(),\n            x = screenPos.x - PROJECT_DESIGN_WIDTH / 2,\n            y = screenPos.y - PROJECT_DESIGN_HEIGHT / 2,\n            z = 0;\n\n        result = new Vec3(x, y, z);\n\n        return result;\n    }\n\n\n    private getRadian(): number {\n        let result: number = null;\n        let directionVector: Vec3;\n        let max_r_pos = this.max_r.getPosition();\n\n        let newPos: Vec2 = new Vec2(max_r_pos.x, max_r_pos.y);\n        directionVector = this.stick.getPosition().subtract(new Vec3(newPos.x, newPos.y, 0));\n\n        result = Math.atan2(directionVector.y, directionVector.x);\n        return result;\n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/en/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/en/scripting/decorator.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/en/scripting/life-cycle-callbacks.html\n */\n"]}