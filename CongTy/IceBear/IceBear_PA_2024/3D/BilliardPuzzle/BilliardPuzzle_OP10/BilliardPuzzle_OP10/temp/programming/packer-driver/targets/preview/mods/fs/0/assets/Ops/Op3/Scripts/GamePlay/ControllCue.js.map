{"version":3,"sources":["file:///D:/PA_2024/3D/BilliardPuzzle/Billiard/assets/Ops/Op3/Scripts/GamePlay/ControllCue.ts"],"names":["Node","_decorator","Component","misc","EventManager","Global","ccclass","property","ControllCue","onEnable","onRegisterEvent","node","on","EventType","TOUCH_START","onMouseDown","TOUCH_MOVE","onMouseMove","TOUCH_CANCEL","onMouseUp","TOUCH_END","event","startingShoot","guide","active","touchPowerBar","isDragging","startY","getLocationY","startYCueUIPos","cueUI","position","y","startXCuePos","cue","x","endGame","delta","power","Math","abs","newY","clampf","setPosition","newX","instance","emit","StartShoot"],"mappings":"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","sourcesContent":["import { Node, EventTouch, _decorator, Component, misc } from \"cc\";\nimport EventManager from \"../Utility3D/Observer/EventManager\";\nimport Global from \"../Utility3D/Global\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('ControllCue')\nexport default class ControllCue extends Component {\n\n    @property(Node)\n    cueUI: Node = null;\n\n    @property(Node)\n    cue: Node = null;\n\n    @property(Node)\n    guide: Node = null;\n\n    private isDragging: boolean = false;\n    private startY: number = 0;\n    private startYCueUIPos: number = 0;\n    private startXCuePos: number = 0;\n    private power: number = 0;\n\n    protected onEnable(): void {\n        this.onRegisterEvent();\n    }\n\n\n    onRegisterEvent() {\n        this.node.on(Node.EventType.TOUCH_START, this.onMouseDown, this);\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onMouseMove, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onMouseUp, this);\n        this.node.on(Node.EventType.TOUCH_END, this.onMouseUp, this);\n    }\n\n    onMouseDown(event: EventTouch) {\n        if (Global.startingShoot) return;\n        this.guide.active = false;\n        Global.touchPowerBar = true;\n        this.isDragging = true;\n        this.startY = event.getLocationY();\n        this.startYCueUIPos = this.cueUI.position.y;\n        this.startXCuePos = this.cue.position.x;\n    }\n\n    onMouseMove(event: EventTouch) {\n        if (Global.endGame) return;\n        if (Global.startingShoot) return;\n        if (!this.isDragging) return;\n        let delta = event.getLocationY() - this.startY;\n        delta *= 1.1;\n        if (delta < 0) {\n            this.power = Math.abs(delta / 407.954);\n\n        } else {\n            this.power = 0;\n        }\n        if (this.power == 0) return;\n        this.power = this.power <= 0.1 ? 0.1 : this.power;\n        this.power = this.power >= 1 ? 1 : this.power;\n        let newY = this.startYCueUIPos + delta;\n        newY = misc.clampf(newY, -418, -10.046);\n        this.cueUI.setPosition(0, newY, 0);\n\n\n        let newX = this.startXCuePos + delta * 0.00037994386;\n        newX = misc.clampf(newX, -0.310, -0.155);\n        this.cue.setPosition(newX, 0, 0);\n\n\n    }\n    boolFirstShoot: boolean = false;\n    onMouseUp(event: EventTouch) {\n\n        if (Global.startingShoot) return;\n        this.isDragging = false;\n        if (this.power != 0)\n            EventManager.instance.emit(Global.StartShoot, this.power);\n\n        this.cueUI.setPosition(0, -10.046, 0);\n        this.power = 0;\n        Global.touchPowerBar = false;\n    }\n\n    // protected update(dt: number): void {\n    //     if (this.isDragging) {\n\n    //     }\n    // }\n}\n"]}