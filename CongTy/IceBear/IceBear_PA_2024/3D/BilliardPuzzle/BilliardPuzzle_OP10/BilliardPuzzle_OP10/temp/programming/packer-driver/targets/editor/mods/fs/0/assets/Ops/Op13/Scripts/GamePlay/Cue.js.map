{"version":3,"sources":["file:///D:/PA_2024/3D/BilliardPuzzle/Billiard/assets/Ops/Op13/Scripts/GamePlay/Cue.ts"],"names":["_decorator","Component","Node","RigidBody","Vec3","EventManager","Global","Utility","DefaultBall","GameManager","ccclass","property","Cue","onEnable","start","instance","on","StartShoot","ResetGame","ResetCue","power","endGame","shootCount","Instance","guide","active","defaultBall","getComponent","prePos","node","getWorldPosition","children","joystick","line","dir","pointShoot","subtract","normalize","y","applyForce","multiplyScalar","basePower","getPosition","scheduleOnce","boolFirstShoot","boolStartShoot","startingShoot","SetPos","countToEndcard","btnAll","firstShoot","setPosition","parent","setWorldPosition","isDefaultBallFall","setRotationFromEuler","RandomRangeFloat","update","dt","checkMoving","checkPoint","setWorldRotationFromEuler","unscheduleAllCallbacks"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, log, Node, Quat, RigidBody, Vec3 } from 'cc';\nimport EventManager from '../Utility3D/Observer/EventManager';\nimport Global from '../Utility3D/Global';\nimport Utility from '../Utility3D/Utility';\nimport { DefaultBall } from './DefaultBall';\nimport { GameManager } from '../Utility3D/GameManager';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = Cue\n * DateTime = Tue May 21 2024 16:34:37 GMT+0700 (Indochina Time)\n * Author = PhongDNRocket123\n * FileBasename = Cue.ts\n * FileBasenameNoExtension = Cue\n * URL = db://assets/Scripts/GamePlay/Cue.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/en/\n *\n */\n\n@ccclass('Cue')\nexport class Cue extends Component {\n\n    @property(RigidBody)\n    defaultBall: RigidBody = null;\n\n    @property(Node)\n    pointShoot: Node = null;\n\n    @property(Node)\n    checkPoint: Node = null;\n\n    @property(Node)\n    joystick: Node = null;\n\n    @property(Node)\n    line: Node = null;\n\n    basePower: number = 250;\n    boolStartShoot: Boolean = false;\n    boolFirstShoot: Boolean = false;\n\n\n    protected onEnable(): void {\n\n    }\n    protected start(): void {\n        EventManager.instance.on(Global.StartShoot, this.StartShoot, this);\n        EventManager.instance.on(Global.ResetGame, this.ResetCue, this);\n    }\n    shootCount: number = 0;\n    StartShoot(power: number) {\n        if (Global.endGame) return;\n        this.shootCount += 1;\n        GameManager.Instance(GameManager).guide.active = false;\n        this.defaultBall.getComponent(DefaultBall).prePos = this.defaultBall.node.getWorldPosition();\n        this.node.children[0].children[0].active = false;\n        this.joystick.active = false;\n        this.line.active = false;\n        var dir = this.pointShoot.getWorldPosition().subtract(this.defaultBall.node.getWorldPosition()).normalize();\n        dir.y = 0;\n        dir = dir.normalize();\n        this.defaultBall.applyForce(dir.multiplyScalar(this.basePower * power), this.defaultBall.node.getPosition());\n        this.basePower = 100;\n        this.scheduleOnce(() => {\n            this.boolFirstShoot = true;\n            this.boolStartShoot = true;\n            Global.startingShoot = true;\n        }, 0.1);\n    }\n\n    countToEndcard: number = 0;\n\n    SetPos() {\n        this.countToEndcard += 1;\n        if (this.countToEndcard == 5) {\n            GameManager.Instance(GameManager).btnAll.active = true;\n            //   Global.endGame = true;\n        }\n        Global.startingShoot = false;\n        Global.firstShoot = true;\n        this.line.active = true;\n        this.node.setPosition(new Vec3(-0.155, 0, 0));\n        this.node.children[0].children[0].active = true;\n        this.node.parent.setWorldPosition(this.defaultBall.node.getWorldPosition());\n        this.joystick.active = true;\n        if (!Global.isDefaultBallFall) {\n            this.node.parent.setRotationFromEuler(0, Utility.RandomRangeFloat(-30, 30), 1);\n        }\n        Global.isDefaultBallFall = false;\n    }\n    protected update(dt: number): void {\n        if (Global.endGame) return;\n        //log(\"joystick3 \" + this.node.parent.getWorldPosition().x);\n        //  log(\"ball \" + this.defaultBall.node.getWorldPosition());\n        //  log(\"cue \" + this.node.children[0].children[0].getPosition());\n        if (!this.defaultBall.node.getComponent(DefaultBall).checkMoving() && this.boolFirstShoot) {\n            if (this.boolStartShoot) {\n\n                this.boolStartShoot = false;\n                this.scheduleOnce(() => {\n                    this.SetPos();\n                }, 1);\n            }\n            //log(\"notmoving\");\n        }\n\n    }\n    ResetCue() {\n        if (this.shootCount <= 1) {\n            this.shootCount = 0;\n            Global.firstShoot = false;\n            Global.startingShoot = false;\n            this.basePower = 250;\n        }\n        this.checkPoint.active = true;\n        //this.basePower = 200;\n        this.boolStartShoot = false;\n        this.boolFirstShoot = false;\n        Global.startingShoot = false;\n        this.line.active = true;\n        this.node.parent.setWorldRotationFromEuler(0, 0, 0);\n        this.node.setPosition(new Vec3(-0.155, 0, 0));\n        this.node.children[0].children[0].active = true;\n        this.node.parent.setWorldPosition(this.defaultBall.node.getWorldPosition());\n        this.joystick.active = true;\n        this.unscheduleAllCallbacks();\n    }\n\n\n}\n\n\n"]}