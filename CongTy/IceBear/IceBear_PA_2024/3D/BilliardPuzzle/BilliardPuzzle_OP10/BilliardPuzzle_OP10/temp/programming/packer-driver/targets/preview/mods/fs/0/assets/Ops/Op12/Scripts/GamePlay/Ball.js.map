{"version":3,"sources":["file:///D:/PA_2024/3D/BilliardPuzzle/Billiard/assets/Ops/Op12/Scripts/GamePlay/Ball.ts"],"names":["_decorator","Component","Node","RigidBody","SphereCollider","tween","Vec3","EventManager","Global","GameManager","SoundManager","ccclass","property","Ball","ZERO","onEnable","prePos","node","getPosition","instance","on","ActiveRb","ResetGame","ResetBall","rb","useCCD","collider","getComponent","onTriggerEnter","onCollisionEnter","Init","start","indexBall","Number","getCurrentBallNumber","name","ballUI","getChildByName","str","parts","split","number","type","Type","DYNAMIC","linearFactor","angularFactor","angularDamping","linearDamping","useGravity","event","otherCollider","getGroup","Instance","PlaySound","otherTrigger","enabled","RollIOnHole","hole","boolOnHole","clearVelocity","to","position","getWorldPosition","call","active","ActiveTextPraise","activeFx","emit","SpawnPotedBall","firstShoot","setWorldPosition","setRotationFromEuler","KINEMATIC","update","dt","CalculateShadow","shadow","setWorldRotationFromEuler"],"mappings":"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","sourcesContent":["\nimport { _decorator, Collider, Component, Director, game, ICollisionEvent, ITriggerEvent, Layers, log, math, Node, physics, RigidBody, SphereCollider, tween, Vec3 } from 'cc';\nimport EventManager from '../Utility3D/Observer/EventManager';\nimport Global from '../Utility3D/Global';\nimport { GameManager } from '../Utility3D/GameManager';\nimport { SoundManager } from '../Utility3D/SoundManager';\nconst { ccclass, property } = _decorator;\n\n\n@ccclass('Ball')\nexport class Ball extends Component {\n\n    @property(RigidBody)\n    rb: RigidBody = null;\n\n    @property(Node)\n    shadow: Node = null;\n\n    collider: Collider = null;\n\n    ballUI: Node = null;\n\n    indexBall: number = null;\n\n    prePos: Vec3 = Vec3.ZERO;\n\n\n    protected onEnable(): void {\n        this.prePos = this.node.getPosition();\n        EventManager.instance.on(Global.ActiveRb, this.ActiveRb, this);\n        EventManager.instance.on(Global.ResetGame, this.ResetBall, this);\n        this.rb.useCCD = true;\n        this.collider = this.node.getComponent(SphereCollider);\n        this.collider.on('onTriggerEnter', this.onTriggerEnter, this);\n        this.collider.on('onCollisionEnter', this.onCollisionEnter, this);\n\n        this.Init();\n    }\n\n\n    protected start(): void {\n\n    }\n\n\n    Init(): void {\n        this.indexBall = Number(this.getCurrentBallNumber(this.node.name)) - 1;\n        this.ballUI = this.node.getChildByName(\"Ball\");\n    }\n\n\n    private getCurrentBallNumber(str: string): string {\n        const parts = str.split('_');\n        const number = parts[1];\n\n        return number;\n    }\n\n\n    ActiveRb() {\n        this.rb.type = RigidBody.Type.DYNAMIC;\n        this.rb.useCCD = true;\n        this.rb.linearFactor = new Vec3(1, 1, 1);\n        this.rb.angularFactor = new Vec3(1, 1, 1);\n        this.rb.angularDamping = 0.7;\n        this.rb.linearDamping = 0.2;\n        this.rb.useGravity = true;\n    }\n\n\n    protected onCollisionEnter(event: ICollisionEvent) {\n        const otherCollider = event.otherCollider;\n        if (event.type === 'onCollisionEnter') {\n\n            if (otherCollider.getGroup() === 2) {\n                // if(!Global.firstShoot) return;\n                SoundManager.Instance(SoundManager).PlaySound(\"HitBall\");\n                // log(\"clear force\");\n                // this.rb.clearForces();\n            }\n            if (otherCollider.getGroup() === 8) {\n                //   SoundManager.Instance(SoundManager).PlaySound(\"HitEdge\");\n                //   log(\"clear force\");\n                //this.rb.clearForces();\n            }\n            //  log(\"clear force\");\n        }\n    }\n\n\n    protected onTriggerEnter(event: ITriggerEvent) {\n        const otherTrigger = event.otherCollider;\n\n        if (event.type === 'onTriggerEnter') {\n            //    log(this.node.name + \" trigger \" + otherTrigger.node.name);\n            if (otherTrigger.getGroup() === 8) {\n                SoundManager.Instance(SoundManager).PlaySound(\"HitPocket\");\n                SoundManager.Instance(SoundManager).PlaySound(\"winSound\");\n\n                this.rb.enabled = false;\n                this.RollIOnHole(otherTrigger.node);\n            }\n        }\n    }\n\n    boolOnHole: boolean = false;\n    RollIOnHole(hole: Node) {\n        if (this.boolOnHole) return;\n        this.boolOnHole = true;\n        this.rb.clearVelocity();\n        tween(this.node)\n            .to(0.08, { position: hole.getWorldPosition() })\n            .call(() => {\n                if (this.ballUI) {\n                    this.ballUI.active = false;\n                }\n                this.node.active = false;\n                this.collider.enabled = false;\n\n                GameManager.Instance(GameManager).ActiveTextPraise();\n                GameManager.Instance(GameManager).activeFx(hole);\n                EventManager.instance.emit(Global.SpawnPotedBall, this.indexBall);\n            })\n            .start();\n    }\n\n\n    public ResetBall() {\n        if (this.boolOnHole) return;\n        if (Global.firstShoot) return;\n        this.node.setWorldPosition(this.prePos);\n        this.node.setRotationFromEuler(90, 90, 0);\n        this.rb.type = RigidBody.Type.KINEMATIC;\n        this.rb.useGravity = false;\n        this.rb.enabled = true;\n        this.collider.enabled = true;\n\n    }\n\n\n    protected update(dt: number): void {\n        this.CalculateShadow();\n    }\n\n\n    CalculateShadow() {\n        this.shadow.setWorldRotationFromEuler(-90, 0, 0);\n    }\n\n\n}\n\n\n"]}