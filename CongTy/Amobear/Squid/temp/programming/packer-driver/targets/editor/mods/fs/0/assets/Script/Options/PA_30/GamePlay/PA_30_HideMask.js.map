{"version":3,"sources":["file:///D:/CocosProjects/Amobear/Squid/assets/Script/Options/PA_30/GamePlay/PA_30_HideMask.ts"],"names":["_decorator","Camera","Component","geometry","Node","PhysicsSystem","GameInfo","GameController","BoxBehavior","PA_30_CameraController","HayChonGiaDung","ccclass","property","PA_30_HideMask","start","registerEvent","node","on","EventType","TOUCH_START","touchStart","TOUCH_END","touchEnd","TOUCH_CANCEL","event","isCanTouch","IsPlaying","isToStore","IsShowPopupInstall","Squid_PA_30","isDetachCandy","boxChoosen","detachResult","getCurrentRollResult","wrong","nextDetach","isChooseBox","isPlayingDetachCandy","isStartPlaying","setAnimDetachCandyState","getRaycastResult","touchPos","ray","Ray","Cam_3D","screenPointToRay","getLocationX","getLocationY","mask","maxDistance","queryTrigger","instance","raycastClosest","raycastClosestResult","collider","name","includes","boxWorldPos","worldPosition","boxBehavior","getComponent","cameraController","activeUnBoxAnim","target","needle","handleGoToBox","boxToTarget","createLine"],"mappings":"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","sourcesContent":["import { _decorator, Animation, Camera, Component, EventTouch, geometry, instantiate, log, Node, PhysicsSystem, Prefab } from 'cc';\nimport { GameInfo } from '../../../CONST/GameInfo';\nimport { GameController } from '../../../Controller/GameController';\nimport { Utils } from '../../../Others/Utils';\nimport { BoxBehavior } from '../Box/BoxBehavior';\nimport { PA_30_CameraController } from '../Controller/PA_30_CameraController';\nimport { HayChonGiaDung } from '../Others/HayChonGiaDung';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = PA_30_HideMask\n * DateTime = Sat Dec 28 2024 14:36:14 GMT+0700 (Indochina Time)\n * Author = hoanghiep2001\n * FileBasename = PA_30_HideMask.ts\n * FileBasenameNoExtension = PA_30_HideMask\n * URL = db://assets/Script/Options/PA_30/GamePlay/PA_30_HideMask.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/en/\n *\n */\n \n@ccclass('PA_30_HideMask')\nexport class PA_30_HideMask extends Component {\n\n    @property(GameController)\n    GameController: GameController = null;\n    @property(Camera)\n    Cam_3D: Camera = null;\n\n    @property(HayChonGiaDung)\n    HayChonGiaDung: HayChonGiaDung = null;\n\n\n    // @property(Prefab)\n    // Line: Prefab = null;\n\n\n    isChooseBox: boolean = false;\n    isPlayingDetachCandy: boolean = false;\n    boxChoosen: BoxBehavior = null;\n\n\n    protected start(): void {\n        this.registerEvent();\n    }\n\n\n    private registerEvent(): void {\n        // let test: Node = null;\n\n        this.node.on(Node.EventType.TOUCH_START, this.touchStart, this);\n        this.node.on(Node.EventType.TOUCH_END, this.touchEnd, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.touchEnd, this);\n    }\n\n\n    private touchStart(event: EventTouch): void {\n        if (!GameInfo.isCanTouch || !GameInfo.IsPlaying) return;\n\n        // IronSource.handleIronSourcePlaySound();\n\n        if (GameInfo.isToStore || GameInfo.IsShowPopupInstall) {\n            // applovin, mtg\n            // this.GameController.installHandle();\n            return;\n        }\n\n\n        if(GameInfo.Squid_PA_30.isDetachCandy) {\n            this.HayChonGiaDung.boxChoosen = this.boxChoosen;\n            const detachResult = this.HayChonGiaDung.getCurrentRollResult();\n\n            if(!detachResult) this.HayChonGiaDung.wrong();\n            else this.HayChonGiaDung.nextDetach();\n           \n            return;\n        }\n\n\n        if(this.isChooseBox) {\n            if(!this.isPlayingDetachCandy) {\n                GameInfo.Squid_PA_30.isStartPlaying = true;\n                this.isPlayingDetachCandy = true;\n                this.boxChoosen.setAnimDetachCandyState(\"play\");\n                // this.\n            }\n            this.boxChoosen.setAnimDetachCandyState(\"resume\");\n            return;\n        }\n\n        this.getRaycastResult(event);\n    }\n\n\n    private getRaycastResult(touchPos: EventTouch): void {\n        let ray = new geometry.Ray();\n        this.Cam_3D.screenPointToRay(touchPos.getLocationX(), touchPos.getLocationY(), ray);\n        // The following parameters are optional\n        const mask = 0xffffffff;\n        const maxDistance = 10000000;\n        const queryTrigger = true;\n\n        if (PhysicsSystem.instance.raycastClosest(ray, mask, maxDistance, queryTrigger)) {\n            const raycastClosestResult = PhysicsSystem.instance.raycastClosestResult;\n            const collider = raycastClosestResult.collider;\n\n            if (collider.node.name.includes(\"Box\")\n            ) {\n                this.isChooseBox = true;\n\n                const boxWorldPos = collider.node.worldPosition;\n                const boxBehavior = collider.getComponent(BoxBehavior);\n                const cameraController = this.Cam_3D.getComponent(PA_30_CameraController);\n\n                this.boxChoosen = boxBehavior;\n\n                boxBehavior.activeUnBoxAnim();\n                cameraController.target = boxBehavior.needle;\n                cameraController.handleGoToBox(boxWorldPos);\n                cameraController.boxToTarget = this.boxChoosen.node;\n                // const boxIndex = Utils.getTrailingNumber(collider.node.name);\n                // collider.getComponent(animation)\n            }\n        }\n    }\n\n\n    private touchEnd(): void {\n        if(this.isChooseBox) {\n            this.boxChoosen.setAnimDetachCandyState(\"pause\");\n            // this.boxChoosen.KeoSao.getComponent(Animation).pause()\n            return;\n        }\n    }\n\n\n    private createLine(): void {\n        // let needleworldPos = this.boxChoosen.needle.getPosition();\n        // let newLine = instantiate(this.Line);\n        // newLine.setRotationFromEuler(-90,0,0);\n        // newLine.setScale(0.44, 0.44, 0.7049 * 0.44 / 100);\n        // newLine.setPosition(needleworldPos.x + 0.08, needleworldPos.y + 0.24, needleworldPos.z + 0.13);\n        // newLine.parent = this.boxChoosen.node;\n        // log(newLine.getPosition())\n        // GameInfo.Squid_PA_30.lineRenderPoints.push(this.boxChoosen.needle.worldPosition);\n    }\n\n\n    // protected update(dt: number): void {\n        // if(GameInfo.Squid_PA_30.isDetachCandy) this.createLine();\n    // }\n}   \n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/en/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/en/scripting/decorator.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/en/scripting/life-cycle-callbacks.html\n */\n"]}