{"version":3,"sources":["file:///D:/CocosProjects/Amobear/Squid/assets/Script/Options/PA_30/Controller/PA_30_CameraController.ts"],"names":["_decorator","Camera","Component","easing","tween","Vec3","GameInfo","TimeCount","ccclass","property","PA_30_CameraController","start","handleTweenToTable","tablePos","newEuler","node","to","eulerAngles","position","smooth","call","isCanTouch","handleGoToBox","boxWorldPos","cameraComp","getComponent","currentFov","fov","worldPosition","x","y","z","delay","isReadyToLookAt","active","handleLookAt","target","getWorldPosition","_targetPos","cameraPos","followHeight","followDistance","setWorldPosition","lookAt","combackOriginalPos","isCombackOriginalPos","ORIGINAL_FOV","ORIGINAL_POS","ORIGINAL_EULER","showFullBox","isShowFullBox","needleTarget","getPosition","targetWorldPos","boxToTarget","newWorldPos","Squid_PA_30","isDetachCandy","update","dt","isDoneDrawCandy","isTimeOver","isDoneAllStep"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAcC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;;AACpDC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;wCAGaU,sB,WADZF,OAAO,CAAC,wBAAD,C,UAGHC,QAAQ;AAAA;AAAA,iC,oCAHb,MACaC,sBADb,SAC4CR,SAD5C,CACsD;AAAA;AAAA;;AAAA;;AAAA,gDAM7B,IAAIG,IAAJ,CAAS,CAAC,IAAV,EAAgB,KAAhB,EAAuB,IAAvB,CAN6B;;AAAA,kDAO3B,IAAIA,IAAJ,CAAS,CAAC,EAAV,EAAc,CAAC,EAAf,EAAmB,CAAnB,CAP2B;;AAAA,gDAQ3B,EAR2B;;AAAA,+CAU9B,IAV8B;;AAAA,0CAWnC,IAXmC;;AAAA,kDAYlB,GAZkB;;AAAA,gDAapB,GAboB;;AAAA,8CAcvB,IAAIA,IAAJ,EAduB;;AAAA,mDAgBvB,KAhBuB;;AAAA,iDAkBzB,KAlByB;;AAAA,wDAoBlB,KApBkB;AAAA;;AAuBxCM,QAAAA,KAAK,GAAS,CACpB;AACH;;AAGMC,QAAAA,kBAAkB,GAAS;AAC9B,cAAMC,QAAc,GAAG,IAAIR,IAAJ,CAAS,KAAT,EAAgB,KAAhB,EAAuB,CAAC,IAAxB,CAAvB;AAAA,cACIS,QAAc,GAAG,IAAIT,IAAJ,CAAS,CAAC,EAAV,EAAc,CAAC,CAAf,EAAkB,CAAlB,CADrB;AAGAD,UAAAA,KAAK,CAAC,KAAKW,IAAN,CAAL,CACKC,EADL,CACQ,CADR,EACW;AAAEC,YAAAA,WAAW,EAAEH,QAAf;AAAyBI,YAAAA,QAAQ,EAAEL;AAAnC,WADX,EAC0D;AAAEV,YAAAA,MAAM,EAAEA,MAAM,CAACgB;AAAjB,WAD1D,EAEKC,IAFL,CAEU,MAAM;AAAA;AAAA,oCAASC,UAAT,GAAsB,IAFtC,EAGKV,KAHL;AAIH;;AAGMW,QAAAA,aAAa,CAACC,WAAD,EAA0B;AAC1C,cAAMT,QAAQ,GAAG,IAAIT,IAAJ,CAAS,CAAC,EAAV,EAAc,CAAC,CAAf,EAAkB,CAAlB,CAAjB;AACA,cAAMmB,UAAU,GAAG,KAAKC,YAAL,CAAkBxB,MAAlB,CAAnB;AACA,cAAMyB,UAAkB,GAAGF,UAAU,CAACG,GAAtC;AAEAvB,UAAAA,KAAK,CAAC,KAAKW,IAAN,CAAL,CACCC,EADD,CACI,CADJ,EACO;AAACY,YAAAA,aAAa,EAAE,IAAIvB,IAAJ,CAASkB,WAAW,CAACM,CAArB,EAAwBN,WAAW,CAACO,CAAZ,GAAgB,CAAxC,EAA2CP,WAAW,CAACQ,CAAZ,GAAgB,CAA3D,CAAhB;AACCd,YAAAA,WAAW,EAAEH;AADd,WADP,EAGG;AAACX,YAAAA,MAAM,EAAEA,MAAM,CAACgB;AAAhB,WAHH,EAICR,KAJD;AAMAP,UAAAA,KAAK,CAACoB,UAAD,CAAL,CACCQ,KADD,CACO,GADP,EAEChB,EAFD,CAEI,GAFJ,EAES;AAAEW,YAAAA,GAAG,EAAED,UAAU,GAAG;AAApB,WAFT,EAEmC;AAAEvB,YAAAA,MAAM,EAAEA,MAAM,CAACgB;AAAjB,WAFnC,EAGCC,IAHD,CAGM,MAAM;AACR,iBAAKa,eAAL,GAAuB,IAAvB;AACA,iBAAK1B,SAAL,CAAeQ,IAAf,CAAoBmB,MAApB,GAA6B,IAA7B;AACH,WAND,EAOCvB,KAPD;AAQH;;AAGOwB,QAAAA,YAAY,GAAS;AACzB,cAAI,CAAC,KAAKC,MAAN,IAAgB,CAAC,KAAKH,eAA1B,EAA2C,OADlB,CAGzB;;AACA,eAAKG,MAAL,CAAYC,gBAAZ,CAA6B,KAAKC,UAAlC,EAJyB,CAMzB;;AACA,cAAMC,SAAS,GAAG,IAAIlC,IAAJ,CACd,KAAKiC,UAAL,CAAgBT,CADF,EAEd,KAAKS,UAAL,CAAgBR,CAAhB,GAAoB,KAAKU,YAFX,EAGd,KAAKF,UAAL,CAAgBP,CAAhB,GAAoB,KAAKU,cAHX,CAAlB,CAPyB,CAazB;;AACA,eAAK1B,IAAL,CAAU2B,gBAAV,CAA2BH,SAA3B,EAdyB,CAgBzB;;AACA,eAAKxB,IAAL,CAAU4B,MAAV,CAAiB,KAAKL,UAAtB;AACH;;AAGOM,QAAAA,kBAAkB,GAAS;AAC/B,eAAKC,oBAAL,GAA4B,IAA5B;AAEA,eAAKT,MAAL,GAAc,IAAd;AAEA,cAAMZ,UAAU,GAAG,KAAKC,YAAL,CAAkBxB,MAAlB,CAAnB;AAEAG,UAAAA,KAAK,CAACoB,UAAD,CAAL,CACCR,EADD,CACI,GADJ,EACS;AAACW,YAAAA,GAAG,EAAE,KAAKmB;AAAX,WADT,EACmC;AAAC3C,YAAAA,MAAM,EAAEA,MAAM,CAACgB;AAAhB,WADnC,EAECR,KAFD;AAIAP,UAAAA,KAAK,CAAC,KAAKW,IAAN,CAAL,CACCiB,KADD,CACO,GADP,EAEChB,EAFD,CAEI,GAFJ,EAES;AAACE,YAAAA,QAAQ,EAAE,KAAK6B,YAAhB;AAA8B9B,YAAAA,WAAW,EAAE,KAAK+B;AAAhD,WAFT,EAE0E;AAAC7C,YAAAA,MAAM,EAAEA,MAAM,CAACgB;AAAhB,WAF1E,EAGCR,KAHD;AAIH;;AAGOsC,QAAAA,WAAW,GAAS;AACxB,cAAG,KAAKC,aAAR,EAAuB;AACvB,eAAKA,aAAL,GAAqB,IAArB;AAEA,cAAIC,YAAY,GAAG,KAAKf,MAAL,CAAYgB,WAAZ,EAAnB;AAEAhD,UAAAA,KAAK,CAAC,KAAKgC,MAAN,CAAL,CACCpB,EADD,CACI,GADJ,EACS;AAACE,YAAAA,QAAQ,EAAE,IAAIb,IAAJ,CAAS8C,YAAY,CAACtB,CAAtB,EAAyBsB,YAAY,CAACrB,CAAb,GAAiB,EAA1C,EAA8CqB,YAAY,CAACpB,CAA3D;AAAX,WADT,EACoF;AAAC5B,YAAAA,MAAM,EAAEA,MAAM,CAACgB;AAAhB,WADpF,EAECR,KAFD;AAIA,eAAKyB,MAAL,GAAc,IAAd;AACA,eAAKH,eAAL,GAAuB,KAAvB;AAEA,cAAMT,UAAU,GAAG,KAAKC,YAAL,CAAkBxB,MAAlB,CAAnB;AACA,cAAMoD,cAAc,GAAG,KAAKC,WAAL,CAAiB1B,aAAxC;AACA,cAAM2B,WAAW,GAAG,IAAIlD,IAAJ,CAASgD,cAAc,CAACxB,CAAxB,EAA2BwB,cAAc,CAACvB,CAAf,GAAmB,CAA9C,EAAiDuB,cAAc,CAACtB,CAAhE,CAApB;AACA,cAAMjB,QAAQ,GAAG,IAAIT,IAAJ,CAAS,CAAC,EAAV,EAAc,CAAC,CAAf,EAAkB,CAAlB,CAAjB;AAEAD,UAAAA,KAAK,CAACoB,UAAD,CAAL,CACCR,EADD,CACI,GADJ,EACS;AAACW,YAAAA,GAAG,EAAE,KAAKmB;AAAX,WADT,EACmC;AAAC3C,YAAAA,MAAM,EAAEA,MAAM,CAACgB;AAAhB,WADnC,EAECR,KAFD;AAIAP,UAAAA,KAAK,CAAC,KAAKW,IAAN,CAAL,CACCiB,KADD,CACO,GADP,EAEChB,EAFD,CAEI,GAFJ,EAES;AAACY,YAAAA,aAAa,EAAE2B,WAAhB;AAA6BtC,YAAAA,WAAW,EAAEH;AAA1C,WAFT,EAE8D;AAACX,YAAAA,MAAM,EAAEA,MAAM,CAACgB;AAAhB,WAF9D,EAGCC,IAHD,CAGM,MAAM;AAAA;AAAA,oCAASoC,WAAT,CAAqBC,aAArB,GAAqC,IAHjD,EAIC9C,KAJD;AAKH;;AAGS+C,QAAAA,MAAM,CAACC,EAAD,EAAmB;AAC/B,eAAKxB,YAAL;AACA,cAAG;AAAA;AAAA,oCAASqB,WAAT,CAAqBI,eAArB,IAAwC,CAAC;AAAA;AAAA,oCAASJ,WAAT,CAAqBK,UAAjE,EAA6E,KAAKZ,WAAL;AAC7E,cAAG;AAAA;AAAA,oCAASO,WAAT,CAAqBK,UAArB,IAAmC,CAAC,KAAKhB,oBAA5C,EAAkE,KAAKD,kBAAL;AAClE,cAAG;AAAA;AAAA,oCAASY,WAAT,CAAqBM,aAArB,IAAsC,CAAC,KAAKjB,oBAA/C,EAAqE,KAAKD,kBAAL;AACxE;;AAvIiD,O;;;;;iBAG3B,I","sourcesContent":["import { _decorator, Camera, Component, easing, Node, tween, Vec3 } from 'cc';\nimport { GameInfo } from '../../../CONST/GameInfo';\nimport { TimeCount } from '../Others/TimeCount';\nconst { ccclass, property } = _decorator;\n/**\n * Predefined variables\n * Name = CameraController\n * DateTime = Sat Dec 28 2024 14:11:22 GMT+0700 (Indochina Time)\n * Author = hoanghiep2001\n * FileBasename = CameraController.ts\n * FileBasenameNoExtension = CameraController\n * URL = db://assets/Script/Controller/CameraController.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/en/\n *\n */\n\n@ccclass('PA_30_CameraController')\nexport class PA_30_CameraController extends Component {\n\n    @property(TimeCount)\n    TimeCount: TimeCount = null;\n\n\n    ORIGINAL_POS: Vec3 = new Vec3(-11.4, 8.972, 11.4);\n    ORIGINAL_EULER: Vec3 = new Vec3(-15, -45, 0);\n    ORIGINAL_FOV: number = 45;\n\n    boxToTarget: Node = null;\n    target: Node = null;\n    public followDistance: number = 1.1; // Khoảng cách từ camera đến needle\n    public followHeight: number = 1.1; // Chiều cao của camera so với needle\n    private _targetPos: Vec3 = new Vec3();\n\n    isReadyToLookAt: boolean = false;\n\n    isShowFullBox: boolean = false;\n\n    isCombackOriginalPos: boolean = false;\n\n\n    protected start(): void {\n        // this.originalPos = this.node.getPosition();\n    }\n\n\n    public handleTweenToTable(): void {\n        const tablePos: Vec3 = new Vec3(0.338, 9.477, -0.31),\n            newEuler: Vec3 = new Vec3(-90, -5, 0);\n\n        tween(this.node)\n            .to(2, { eulerAngles: newEuler, position: tablePos }, { easing: easing.smooth })\n            .call(() => GameInfo.isCanTouch = true)\n            .start();\n    }\n\n\n    public handleGoToBox(boxWorldPos: Vec3): void {\n        const newEuler = new Vec3(-45, -5, 0);\n        const cameraComp = this.getComponent(Camera);\n        const currentFov: number = cameraComp.fov;\n\n        tween(this.node)\n        .to(1, {worldPosition: new Vec3(boxWorldPos.x, boxWorldPos.y + 3, boxWorldPos.z + 3),\n                eulerAngles: newEuler\n        }, {easing: easing.smooth})\n        .start();\n\n        tween(cameraComp)\n        .delay(0.5)\n        .to(0.3, { fov: currentFov - 18 }, { easing: easing.smooth })\n        .call(() => {\n            this.isReadyToLookAt = true;\n            this.TimeCount.node.active = true;\n        })\n        .start();\n    }\n\n\n    private handleLookAt(): void {\n        if (!this.target || !this.isReadyToLookAt) return;\n\n        // Lấy vị trí hiện tại của needle\n        this.target.getWorldPosition(this._targetPos);\n\n        // Tính toán vị trí camera (phía sau needle)\n        const cameraPos = new Vec3(\n            this._targetPos.x,\n            this._targetPos.y + this.followHeight,\n            this._targetPos.z + this.followDistance\n        );\n\n        // Di chuyển camera đến vị trí mới\n        this.node.setWorldPosition(cameraPos);\n\n        // Hướng camera đến needle\n        this.node.lookAt(this._targetPos);\n    }\n\n\n    private combackOriginalPos(): void {\n        this.isCombackOriginalPos = true;\n\n        this.target = null;\n\n        const cameraComp = this.getComponent(Camera);\n\n        tween(cameraComp)\n        .to(0.3, {fov: this.ORIGINAL_FOV}, {easing: easing.smooth})\n        .start();\n\n        tween(this.node)\n        .delay(0.3)\n        .to(0.5, {position: this.ORIGINAL_POS, eulerAngles: this.ORIGINAL_EULER}, {easing: easing.smooth})\n        .start();\n    }\n\n\n    private showFullBox(): void {\n        if(this.isShowFullBox) return;\n        this.isShowFullBox = true;\n\n        let needleTarget = this.target.getPosition();\n\n        tween(this.target)\n        .to(0.3, {position: new Vec3(needleTarget.x, needleTarget.y - 10, needleTarget.z)}, {easing: easing.smooth})\n        .start();\n\n        this.target = null;\n        this.isReadyToLookAt = false;\n\n        const cameraComp = this.getComponent(Camera);\n        const targetWorldPos = this.boxToTarget.worldPosition;\n        const newWorldPos = new Vec3(targetWorldPos.x, targetWorldPos.y + 3, targetWorldPos.z)\n        const newEuler = new Vec3(-90, -5, 0)\n\n        tween(cameraComp)\n        .to(0.3, {fov: this.ORIGINAL_FOV}, {easing: easing.smooth})\n        .start();\n\n        tween(this.node)\n        .delay(0.3)\n        .to(0.5, {worldPosition: newWorldPos, eulerAngles: newEuler}, {easing: easing.smooth})\n        .call(() => GameInfo.Squid_PA_30.isDetachCandy = true)\n        .start();\n    }\n\n\n    protected update(dt: number): void {\n        this.handleLookAt();\n        if(GameInfo.Squid_PA_30.isDoneDrawCandy && !GameInfo.Squid_PA_30.isTimeOver) this.showFullBox();\n        if(GameInfo.Squid_PA_30.isTimeOver && !this.isCombackOriginalPos) this.combackOriginalPos();\n        if(GameInfo.Squid_PA_30.isDoneAllStep && !this.isCombackOriginalPos) this.combackOriginalPos();\n    }\n}\n"]}