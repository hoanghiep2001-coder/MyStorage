{"version":3,"sources":["file:///D:/CocosProjects/Amobear/GTA_All/assets/scripts/Options/PA_10/PA_10_HideMask.ts"],"names":["_decorator","Camera","Component","easing","geometry","log","Node","PhysicsSystem","tween","Vec3","PA_10_UI","GameInfo","SoundController","PA_10_Character","ccclass","property","PA_10_HideMask","start","node","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","touchPos","isCanTouch","isTouching","tutorials","forEach","tut","active","Aim","Cam_3D","to","fov","smooth","screenPos","getUILocation","pos","convertToLocalLocation","setPosition","setAimingAnim","event","setCrouchAnim","getRaycastResult","setAimOriginPos","shoot","ray","Ray","screenPointToRay","getLocationX","getLocationY","mask","maxDistance","queryTrigger","instance","raycastClosest","raycastClosestResult","collider","name","includes","GTA_PA_10","currentEnemyKilled","Instance","playSound","explosionFXs","UI_Blink","value","localX","x","getPosition","localY","y","result","scheduleOnce"],"mappings":"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","sourcesContent":["\nimport { _decorator, Camera, Component, easing, EventTouch, geometry, log, Node, PhysicsSystem, tween, Vec2, Vec3 } from 'cc';\nimport { PA_10_UI } from './PA_10_UI';\nimport { GameInfo } from '../../CONST/GameInfo';\nimport { SoundController } from '../../Controller/SoundController';\nimport { PA_10_Character } from './PA_10_Character';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = PA_10_HideMask\n * DateTime = Wed Dec 25 2024 18:00:18 GMT+0700 (Indochina Time)\n * Author = hoanghiep2001\n * FileBasename = PA_10_HideMask.ts\n * FileBasenameNoExtension = PA_10_HideMask\n * URL = db://assets/scripts/Options/PA_10/PA_10_HideMask.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/en/\n *\n */\n\n@ccclass('PA_10_HideMask')\nexport class PA_10_HideMask extends Component {\n    @property(Camera)\n    Cam_3D: Camera = null;\n\n    @property(PA_10_Character)\n    PA_10_Character: PA_10_Character = null;\n\n    @property(PA_10_UI)\n    PA_10_UI: PA_10_UI = null;\n\n\n    pos: Vec3 = null;\n\n\n    protected start(): void {\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n    }\n\n\n    private onTouchStart(touchPos: EventTouch): void {\n        if(!GameInfo.isCanTouch) return;\n\n        log(\"show aiming UI\");\n\n        GameInfo.isCanTouch = false;\n        \n        GameInfo.isTouching = true;\n\n        this.PA_10_UI.tutorials.forEach(tut => tut.active = false);\n\n        this.PA_10_UI.Aim.active = true;\n        \n        tween(this.Cam_3D)\n        .to(0.3, { fov: 33 }, { easing: easing.smooth })\n        .start();\n        \n        const screenPos = touchPos.getUILocation();\n        this.pos = this.convertToLocalLocation(screenPos);\n        this.PA_10_UI.Aim.setPosition(this.pos);\n        \n        this.PA_10_Character.setAimingAnim();\n\n    }\n\n\n    private onTouchMove(event: EventTouch): void {\n        const screenPos = event.getUILocation();\n        this.pos = this.convertToLocalLocation(screenPos);\n        this.PA_10_UI.Aim.setPosition(this.pos);\n    }\n\n\n    private onTouchEnd(touchPos: EventTouch): void {\n        if(!GameInfo.isTouching) return;\n\n        GameInfo.isTouching = false;\n\n        this.PA_10_Character.setCrouchAnim();\n\n        this.getRaycastResult(touchPos);\n\n        tween(this.Cam_3D)\n            .to(0.3, { fov: 45 }, { easing: easing.smooth })\n            .start();\n\n        this.PA_10_UI.Aim.active = false;\n\n        this.PA_10_UI.setAimOriginPos();\n\n        this.shoot();\n    }\n\n\n    private getRaycastResult(touchPos: EventTouch): void {\n        let ray = new geometry.Ray();\n        this.Cam_3D.screenPointToRay(touchPos.getLocationX(), touchPos.getLocationY(), ray);\n        // The following parameters are optional\n        const mask = 0xffffffff;\n        const maxDistance = 10000000;\n        const queryTrigger = true;\n\n        if (PhysicsSystem.instance.raycastClosest(ray, mask, maxDistance, queryTrigger)) {\n            const raycastClosestResult = PhysicsSystem.instance.raycastClosestResult;\n            const collider = raycastClosestResult.collider;\n\n            if (collider.node.name.includes(\"Grimace\")\n            ) {\n                GameInfo.GTA_PA_10.currentEnemyKilled += 1;\n\n                collider.node.active = false;\n                SoundController.Instance(SoundController).playSound(\"BoomSound\");\n                if(collider.node.name.includes(\"_\")) this.PA_10_UI.explosionFXs[1].node.active = true;\n                else this.PA_10_UI.explosionFXs[0].node.active = true;\n\n                if(GameInfo.GTA_PA_10.currentEnemyKilled === 2) this.PA_10_UI.UI_Blink.active = true;\n            }\n        }\n    }\n\n\n    private convertToLocalLocation(value: Vec2): Vec3 {\n        const localX = value.x - 960 - this.node.getPosition().x;\n        const localY = value.y - 540 - this.node.getPosition().y;\n        const result = new Vec3(localX, localY, 0);\n        return result;\n    }\n\n\n    private shoot(): void {\n        this.scheduleOnce(() => {\n            GameInfo.isCanTouch = true;\n        }, 1)\n\n        SoundController.Instance(SoundController).playSound(\"K98Sound\");\n    }\n\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/en/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/en/scripting/decorator.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/en/scripting/life-cycle-callbacks.html\n */\n"]}