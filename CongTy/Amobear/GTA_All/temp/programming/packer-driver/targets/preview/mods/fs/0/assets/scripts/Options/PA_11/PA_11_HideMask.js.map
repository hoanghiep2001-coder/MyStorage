{"version":3,"sources":["file:///D:/CocosProjects/Amobear/GTA_All/assets/scripts/Options/PA_11/PA_11_HideMask.ts"],"names":["_decorator","Camera","Component","easing","geometry","log","Node","PhysicsSystem","tween","Vec3","GameInfo","SoundController","PA_11_UI","PA_11_Character","ccclass","property","PA_11_HideMask","start","node","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","touchPos","isCanTouch","GTA_PA_11","isCharacterDead","isTouching","Text_MoreEnemy","active","tutorials","forEach","tut","Aim","Cam_3D","to","fov","smooth","screenPos","getUILocation","pos","convertToLocalLocation","setPosition","setAimingAnim","event","setCrouchAnim","getRaycastResult","setAimOriginPos","shoot","ray","Ray","screenPointToRay","getLocationX","getLocationY","mask","maxDistance","queryTrigger","instance","raycastClosest","raycastClosestResult","collider","name","includes","currentEnemyKilled","activeSpineCombo","grimaceIndex","getTrailingNumber","fireBall_Vfx","getChildByName","Instance","playSound","value","localX","x","getPosition","localY","y","result","scheduleOnce","string","match","parseInt"],"mappings":"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","sourcesContent":["\nimport { _decorator, Camera, Component, easing, EventTouch, geometry, log, Node, PhysicsSystem, tween, Vec2, Vec3 } from 'cc';\n\nimport { GameInfo } from '../../CONST/GameInfo';\nimport { SoundController } from '../../Controller/SoundController';\nimport { PA_11_UI } from './PA_11_UI';\nimport { PA_11_Character } from './PA_11_Character';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = PA_10_HideMask\n * DateTime = Wed Dec 25 2024 18:00:18 GMT+0700 (Indochina Time)\n * Author = hoanghiep2001\n * FileBasename = PA_10_HideMask.ts\n * FileBasenameNoExtension = PA_10_HideMask\n * URL = db://assets/scripts/Options/PA_10/PA_10_HideMask.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/en/\n *\n */\n\n@ccclass('PA_11_HideMask')\nexport class PA_11_HideMask extends Component {\n    @property(Camera)\n    Cam_3D: Camera = null;\n\n    @property(PA_11_Character)\n    PA_11_Character: PA_11_Character = null;\n\n    @property(PA_11_UI)\n    PA_11_UI: PA_11_UI = null;\n\n\n    pos: Vec3 = null;\n\n\n    protected start(): void {\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n    }\n\n\n    private onTouchStart(touchPos: EventTouch): void {\n        if(!GameInfo.isCanTouch || GameInfo.GTA_PA_11.isCharacterDead) return;\n\n        log(\"show aiming UI\");\n        \n        GameInfo.isCanTouch = false;\n\n        GameInfo.isTouching = true;\n\n        this.PA_11_UI.Text_MoreEnemy.active = false;\n\n        this.PA_11_UI.tutorials.forEach(tut => tut.active = false);\n\n        this.PA_11_UI.Aim.active = true;\n        \n        tween(this.Cam_3D)\n        .to(0.3, { fov: 33 }, { easing: easing.smooth })\n        .start();\n        \n        const screenPos = touchPos.getUILocation();\n        this.pos = this.convertToLocalLocation(screenPos);\n        this.PA_11_UI.Aim.setPosition(this.pos);\n        \n        this.PA_11_Character.setAimingAnim();\n\n    }\n\n\n    private onTouchMove(event: EventTouch): void {\n        // this.PA_11_Character.setAimingAnim();\n        const screenPos = event.getUILocation();\n        this.pos = this.convertToLocalLocation(screenPos);\n        this.PA_11_UI.Aim.setPosition(this.pos);\n    }\n\n\n    private onTouchEnd(touchPos: EventTouch): void {\n        if(!GameInfo.isTouching || GameInfo.GTA_PA_11.isCharacterDead) return;\n\n        GameInfo.isTouching = false;\n\n        this.PA_11_Character.setCrouchAnim();\n\n        this.getRaycastResult(touchPos);\n\n        tween(this.Cam_3D)\n            .to(0.3, { fov: 45 }, { easing: easing.smooth })\n            .start();\n\n        this.PA_11_UI.Aim.active = false;\n\n        this.PA_11_UI.setAimOriginPos();\n\n        this.shoot();\n    }\n\n\n    private getRaycastResult(touchPos: EventTouch): void {\n        let ray = new geometry.Ray();\n        this.Cam_3D.screenPointToRay(touchPos.getLocationX(), touchPos.getLocationY(), ray);\n        // The following parameters are optional\n        const mask = 0xffffffff;\n        const maxDistance = 10000000;\n        const queryTrigger = true;\n\n        if (PhysicsSystem.instance.raycastClosest(ray, mask, maxDistance, queryTrigger)) {\n            const raycastClosestResult = PhysicsSystem.instance.raycastClosestResult;\n            const collider = raycastClosestResult.collider;\n\n            if (collider.node.name.includes(\"Grimace\")\n            ) {\n                GameInfo.GTA_PA_11.currentEnemyKilled += 1;\n\n                GameInfo.GTA_PA_11.currentEnemyKilled >= 2 && this.PA_11_UI.activeSpineCombo();\n\n                const grimaceIndex = this.getTrailingNumber(collider.node.name);\n\n                const fireBall_Vfx = this.PA_11_UI.node.getChildByName(`FireBall_${grimaceIndex}`)\n\n                fireBall_Vfx.active = true;\n                collider.node.active = false;\n                SoundController.Instance(SoundController).playSound(\"BoomSound\");\n            }\n        }\n    }\n\n\n    private convertToLocalLocation(value: Vec2): Vec3 {\n        const localX = value.x - 960 - this.node.getPosition().x;\n        const localY = value.y - 540 - this.node.getPosition().y;\n        const result = new Vec3(localX, localY, 0);\n        return result;\n    }\n\n\n    private shoot(): void {\n        this.scheduleOnce(() => {\n            GameInfo.isCanTouch = true;\n        }, 0.5);\n        SoundController.Instance(SoundController).playSound(\"K98Sound\");\n    }\n\n\n    private getTrailingNumber(string: string): number {\n        const match = string.match(/\\d+$/);\n        return match ? parseInt(match[0], 10) : null;\n    }\n\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/en/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/en/scripting/decorator.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/en/scripting/life-cycle-callbacks.html\n */\n"]}