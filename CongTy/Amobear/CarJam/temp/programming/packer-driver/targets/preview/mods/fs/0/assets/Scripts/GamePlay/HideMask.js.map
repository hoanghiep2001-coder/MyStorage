{"version":3,"sources":["file:///D:/CocosProjects/Amobear/CarJam/assets/Scripts/GamePlay/HideMask.ts"],"names":["_decorator","Camera","Component","geometry","log","Node","PhysicsSystem","GameInfo","UIGameController","CONST","GameController","SoundController","CarBehavior","CarEnabledClick","ccclass","property","HideMask","init","start","registerEvent","node","on","EventType","TOUCH_START","touchStart","event","isCanTouch","isToStore","IsShowPopupInstall","installHandle","getRaycastResult","touchPos","ray","Ray","Cam_3D","screenPointToRay","getLocationX","getLocationY","mask","maxDistance","queryTrigger","instance","raycastClosest","raycastClosestResult","collider","name","includes","getComponent","isCarEnabledClick","Tut_1","active","isTouching","Instance","PlaySound","SoundTrack","clickSound","CarBehaviorComp","setMoveBehavior"],"mappings":"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","sourcesContent":["import { _decorator, Camera, Component, EventTouch, geometry, log, Node, physics, Vec2, Vec3, PhysicsSystem } from 'cc';\r\n// import { IronSource } from '../AdHelper/IronSource';\r\nimport { GameInfo } from '../Const/GameInfo';\r\nimport { Utility } from '../Utils/Utility';\r\nimport { LogicGamePlay } from '../Others/HandleLogicGamePlay';\r\nimport { UIGameController } from '../Controller/UIGameController';\r\nimport { CONST } from '../Const/CONST';\r\nimport { GameController } from '../Controller/GameController';\r\nimport { SoundController } from '../Controller/SoundController';\r\nimport { CarBehavior } from '../Car/CarBehavior';\r\nimport { IronSource } from '../AdHelper/IronSource';\r\nimport { CarEnabledClick } from '../Car/CarEnabledClick';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\n@ccclass('HideMask')\r\nexport class HideMask extends Component {\r\n    @property(UIGameController)\r\n    UIGameController: UIGameController = null;\r\n    @property(GameController)\r\n    GameController: GameController = null;\r\n\r\n\r\n    @property(Camera)\r\n    Cam_3D: Camera = null;\r\n\r\n\r\n    private init(): void {\r\n\r\n    }\r\n\r\n\r\n    protected start(): void {\r\n        this.init();\r\n        this.registerEvent();\r\n    }\r\n\r\n\r\n    private registerEvent(): void {\r\n        // let test: Node = null;\r\n\r\n        this.node.on(Node.EventType.TOUCH_START, this.touchStart, this);\r\n    }\r\n\r\n\r\n    private touchStart(event: EventTouch): void {\r\n        if (!GameInfo.isCanTouch) return;\r\n\r\n        // IronSource.handleIronSourcePlaySound();\r\n\r\n        if (GameInfo.isToStore || GameInfo.IsShowPopupInstall) {\r\n            // applovin, mtg\r\n            this.GameController.installHandle();\r\n            return;\r\n        }\r\n\r\n        this.getRaycastResult(event);\r\n    }\r\n\r\n\r\n    private getRaycastResult(touchPos: EventTouch): void {\r\n        let ray = new geometry.Ray();\r\n        this.Cam_3D.screenPointToRay(touchPos.getLocationX(), touchPos.getLocationY(), ray);\r\n        // The following parameters are optional\r\n        const mask = 0xffffffff;\r\n        const maxDistance = 10000000;\r\n        const queryTrigger = true;\r\n\r\n        if (PhysicsSystem.instance.raycastClosest(ray, mask, maxDistance, queryTrigger)) {\r\n            const raycastClosestResult = PhysicsSystem.instance.raycastClosestResult;\r\n            const collider = raycastClosestResult.collider;\r\n\r\n            if (collider.node.name.includes(\"Car\")\r\n                || collider.node.name.includes(\"Van\")\r\n                || collider.node.name.includes(\"Bus\")\r\n            ) {\r\n\r\n                // can't click on car has enabledClick in name\r\n                if(collider.getComponent(CarEnabledClick)?.isCarEnabledClick) {\r\n                    log(\"click blocked\")\r\n                    return\r\n                };\r\n\r\n                this.UIGameController.Tut_1.active = false;\r\n                GameInfo.isTouching = true;\r\n                SoundController.Instance(SoundController).PlaySound(CONST.SoundTrack.clickSound);\r\n                const CarBehaviorComp = collider.node.getComponent(CarBehavior);\r\n                CarBehaviorComp.setMoveBehavior();\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n"]}