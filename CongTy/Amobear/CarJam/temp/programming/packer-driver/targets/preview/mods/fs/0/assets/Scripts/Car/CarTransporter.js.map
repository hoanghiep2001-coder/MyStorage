{"version":3,"sources":["file:///D:/CocosProjects/Amobear/CarJam/assets/Scripts/Car/CarTransporter.ts"],"names":["_decorator","Component","instantiate","math","Node","Prefab","CarSkin","GameInfo","ccclass","property","CarTransporter","start","spawnCar","IsShowPopupInstall","isLose","randomCar","randomRangeInt","newCar","Car_Trans_4Seat","Van_Trans_6Seat","Bus_Trans_10Seat","currentIndexCar","worldPosition","spawnPoint","worldMatrix","slide","getWorldMatrix","localPosition","Vec3","Mat4","invert","transformMat4","setPosition","parent","removePhysicsForTranspoterCar","randomColor","currentOption","carColorNode","getChildByName","children","carSkin","getComponent","active","CarColor","name","car_Top","transpoterCarsArr","push","update","dt","currentSlidePos","position","x","y","z","currentTimeOut"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, instantiate, log, math, Node, Prefab, UITransform } from 'cc';\nimport { CarBehavior } from './CarBehavior';\nimport { CarSkin } from './CarSkin';\nimport { GameInfo } from '../Const/GameInfo';\nconst { ccclass, property } = _decorator;\n\n\n@ccclass('CarTransporter')\nexport class CarTransporter extends Component {\n\n    @property(Prefab)\n    Car_Trans_4Seat: Prefab = null;\n    @property(Prefab)\n    Van_Trans_6Seat: Prefab = null;\n    @property(Prefab)\n    Bus_Trans_10Seat: Prefab = null;\n\n    @property(Node)\n    spawnPoint: Node = null;\n\n    @property(Node)\n    slide: Node = null;\n\n    @property(Node)\n    destroyPoint: Node = null;\n\n    currentIndexCar: number = 1;\n\n    transpoterCarsArr: Node[] = [];\n\n    currentTimeOut: number = 0;\n\n    protected start(): void {\n        // this.spawnCar();\n    }\n\n\n    private spawnCar(): void {\n        // this.schedule(() => {\n            if (GameInfo.IsShowPopupInstall || GameInfo.isLose) return;\n\n            let randomCar = math.randomRangeInt(0, 3);\n            let newCar: Node = null;\n            switch (randomCar) {\n                case 0:\n                    newCar = instantiate(this.Car_Trans_4Seat);\n                    break;\n                case 1:\n                    newCar = instantiate(this.Van_Trans_6Seat);\n                    break;\n                case 2:\n                    newCar = instantiate(this.Bus_Trans_10Seat);\n                    break;\n                default:\n                    break;\n            }\n\n            // log(\"new Transporter Car:\", this.currentIndexCar);\n\n            this.currentIndexCar += 1;\n\n            // Chuyển đổi vị trí spawnPoint từ world space sang local space của slide\n            const worldPosition = this.spawnPoint.worldPosition; // Lấy vị trí toàn cục\n            const worldMatrix = this.slide.getWorldMatrix(); // Ma trận thế giới của slide\n\n            const localPosition = new math.Vec3();\n            math.Mat4.invert(worldMatrix, worldMatrix); // Đảo ngược ma trận thế giới\n            math.Vec3.transformMat4(localPosition, worldPosition, worldMatrix); // Chuyển đổi từ world space sang local space\n\n            newCar.setPosition(localPosition); // Gán vị trí local\n            newCar.parent = this.slide; // Đặt parent là slide\n            this.removePhysicsForTranspoterCar(newCar);\n\n            let randomColor: number = 0;\n\n            if (GameInfo.currentOption === 6) randomColor = math.randomRangeInt(0, 7);\n            else randomColor = math.randomRangeInt(0, 8);\n\n            let carColorNode = newCar.getChildByName(\"base\").children[randomColor];\n            let carSkin = newCar.getComponent(CarSkin);\n            carColorNode.active = true;\n            carSkin.CarColor = carColorNode.name;\n            carSkin.car_Top = carColorNode.getChildByName(\"Top\");\n\n            this.transpoterCarsArr.push(newCar);\n        // }, 1.3);\n    }\n\n\n    private removePhysicsForTranspoterCar(newCar: Node): void {\n        // this.scheduleOnce(() => {\n        //     let carBehavior = newCar.getComponent(CarBehavior)\n        //     if (!carBehavior.isCanMove) carBehavior.removeRigidbody();\n\n        //     this.scheduleOnce(() => {\n        //         if (carBehavior.isTranspoter) return;\n        //         this.transpoterCarsArr.splice(0, 1);\n        //         newCar.active = false;\n        //         newCar.destroy();\n        //         // log(\"Car Trans Destroyed\");\n        //     }, 1)\n        // }, 6.5)\n    }\n\n\n    protected update(dt: number): void {\n        let currentSlidePos = this.slide.position;\n        this.slide.setPosition(currentSlidePos.x + 0.025, currentSlidePos.y, currentSlidePos.z);\n\n        this.currentTimeOut += dt;\n        if(this.currentTimeOut >= 1.6) {\n            this.currentTimeOut = 0;\n            this.spawnCar();\n        }\n    }\n}\n\n"]}