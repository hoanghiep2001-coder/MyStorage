{"version":3,"sources":["file:///D:/CocosProjects/Amobear/CarJam/assets/Scripts/Car/CarBehavior.ts"],"names":["_decorator","Collider","Component","easing","ERigidBodyType","log","math","ParticleSystem","Quat","RigidBody","tween","Vec3","CarStops","GameInfo","CarSkin","SoundController","CONST","CustomerBehavior","ccclass","property","CarBehavior","onLoad","collider","getComponent","rigidBody","node","start","currentQuat","rotation","targetQuat","eulerAnglesY","eulerAngles","y","fxChildrens","initVfx","currentPos","getPosition","on","e","otherCollider","name","includes","isCanMove","removeRigidbody","scheduleOnce","active","destroy","activeVibration","Instance","PlaySound","SoundTrack","Impact","vFX_impact","play","forEach","fx","setRotationFromEuler","turnBack","type","STATIC","CarStopsComp","parent","getChildByName","handleGoToTurnPoint","isTranspoter","setScale","worldPos","getWorldPosition","setWorldPosition","vFX_smoke","vfxNode","fxBounce","children","splice","setMoveBehavior","DYNAMIC","posTurnBack","targetNode","to","position","smooth","applyforce","side","setLinearVelocity","speed","enabled","isCanTouch","stopPoint","CarStopsState","find","state","stopID","id","carSkin","updateStopStates","turnRightPoint","call","handleGoToRoadStopPoint","turnLeftPoint","Down_turnleftPoint","roadStopsPoint","donePoint","stopPointNode","euler","fromEuler","handleGoToStopPoint","car_Top","isReady","IsPlaying","firstCumtomer","currentCustomers","firstCustomerColorID","customerColorID","carStops","every","stop","colorID","isLose","handleDoneFullCustomer","gotoDonePoint","carMoveToPlace","updateRotation","dt","worldPosition","clone","targetPos","direction","subtract","normalize","fromViewUp","UP","slerp","setRotation","update"],"mappings":"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","sourcesContent":["import { _decorator, CCBoolean, CCFloat, Collider, Component, easing, ERigidBodyType, ICollisionEvent, log, math, Node, ParticleSystem, Quat, RigidBody, tween, Vec3 } from 'cc';\nimport { CarStops } from './CarStops';\nimport * as Interface from \"../Const/interface\";\nimport { GameInfo } from '../Const/GameInfo';\nimport { CarSkin } from './CarSkin';\nimport { SoundController } from '../Controller/SoundController';\nimport { CONST } from '../Const/CONST';\nimport { CustomerBehavior } from '../Customer/CustomerBehavior';\nconst { ccclass, property } = _decorator;\n\n\n@ccclass('CarBehavior')\nexport class CarBehavior extends Component {\n    vFX_smoke: ParticleSystem = null;\n    vFX_impact: ParticleSystem = null;\n\n    stopID: number = null;\n    roadStopsPoint: Node = null;\n    eulerAnglesY: number = 0;\n    isCanMove: boolean = false;\n    speed: number = 50;\n    rigidBody: RigidBody = null;\n    collider: Collider = null;\n    side: string = null;\n    donePoint: Node = null;\n\n    isTranspoter: boolean = false;\n\n    targetQuat: Quat = new Quat();\n    currentQuat: Quat = new Quat();\n\n    targetNode: Node = null;\n\n\n    protected onLoad(): void {\n        this.collider = this.getComponent(Collider);\n        this.rigidBody = this.node.getComponent(RigidBody);\n    }\n\n\n    protected start(): void {\n        this.currentQuat = this.node.rotation;\n        this.targetQuat = this.node.rotation;\n        this.eulerAnglesY = this.node.eulerAngles.y;\n\n        const fxChildrens = this.initVfx();\n\n        let currentPos: Vec3 = this.node.getPosition();\n\n        this.collider.on(\"onCollisionEnter\", (e: ICollisionEvent) => {\n\n            // transporter Car\n            if (e.otherCollider.node.name.includes(\"RmRigidbodyPoint\") && !this.isCanMove) {\n                this.removeRigidbody();\n                this.scheduleOnce(() => {\n                    log(\"destroy\")\n                    \n                    this.node.active = false;\n                    this.node.destroy();\n                }, 1);\n            }\n\n            // transporter Car\n            if (e.otherCollider.node.name.includes(\"DestroyPoint\")) {\n                log(\"destroy\")\n                this.node.active = false;\n                this.node.destroy();\n            }\n\n\n            // handle Car in op 9\n            if (e.otherCollider.node.name.includes(\"enabledClick\")) {\n                GameInfo.activeVibration = true;\n                SoundController.Instance(SoundController).PlaySound(CONST.SoundTrack.Impact);\n\n                this.vFX_impact.play();\n                fxChildrens.forEach(fx => fx.getComponent(ParticleSystem));\n                return;\n            }\n\n\n            // handle turn back\n            if (e.otherCollider.node.name.includes(\"Car\")\n                || e.otherCollider.node.name.includes(\"Van\")\n                || e.otherCollider.node.name.includes(\"Bus\")\n            ) {\n                log(this.node.name, \"collided\");\n\n                this.node.setRotationFromEuler(new Vec3(0, this.eulerAnglesY, 0));\n\n                SoundController.Instance(SoundController).PlaySound(CONST.SoundTrack.Impact);\n\n                this.vFX_impact.play();\n                fxChildrens.forEach(fx => fx.getComponent(ParticleSystem));\n                this.isCanMove = false;\n                this.turnBack(currentPos);\n            }\n\n\n            // handle run to Result\n            if (e.otherCollider.node.name.includes(\"PointA\")\n            ) {\n                if (!this.node.name.includes(\"Destroyer\")) this.removeRigidbody();\n                else {\n                    this.rigidBody.type = ERigidBodyType.STATIC;\n                    this.isCanMove = false;\n                }\n                let CarStopsComp: CarStops = this.node.parent.parent.getChildByName(\"CarStops\").getComponent(CarStops);\n                this.handleGoToTurnPoint(CarStopsComp);\n            }\n\n            if (e.otherCollider.node.name.includes(\"PointB\")) {\n                this.isTranspoter = true;\n                this.removeRigidbody();\n\n                if (!this.node.name.includes(\"Destroyer\")) {\n                    this.node.setScale(1.5, 1.5, 1.5);\n\n                    // Lưu lại world position trước khi thay đổi parent\n                    const worldPos = this.node.getWorldPosition();\n\n                    // Thay đổi parent\n                    this.node.parent = this.node.parent.parent.parent.parent.getChildByName(\"Cars\");\n\n                    // Thiết lập lại world position\n                    this.node.setWorldPosition(worldPos);\n                }\n\n\n                // Các logic khác\n                let CarStopsComp: CarStops = this.node.parent.parent.getChildByName(\"CarStops\").getComponent(CarStops);\n                this.handleGoToTurnPoint(CarStopsComp);\n            }\n        });\n    }\n\n\n    private initVfx(): Node[] {\n        this.vFX_smoke= this.node.getChildByName(\"VFX_Smoke\").getComponent(ParticleSystem);\n        this.vFX_smoke.node.active = false;\n\n        let vfxNode = this.node.getChildByName(\"VFX_Impact2\");\n        this.getComponent(CarSkin).fxBounce = vfxNode.children[2].getComponent(ParticleSystem);\n        let fxChildrens = vfxNode.children;\n        fxChildrens.splice(2, 1);\n        this.vFX_impact = vfxNode.getComponent(ParticleSystem);\n\n        return fxChildrens;\n    }\n\n\n    public setMoveBehavior(): void {\n        this.rigidBody.type = ERigidBodyType.DYNAMIC;\n        this.isCanMove = true;\n    }\n\n\n    private turnBack(posTurnBack: Vec3): void {\n        this.targetNode = null;\n        if (!this.node.name.includes(\"Trans\")) this.rigidBody.type = ERigidBodyType.STATIC;\n\n        this.node.setRotationFromEuler(new Vec3(0, this.eulerAnglesY, 0));\n        tween(this.node)\n            .to(0.2, { position: posTurnBack }, { easing: easing.smooth })\n            .start();\n    }\n\n\n    private applyforce(): void {\n        switch (this.eulerAnglesY) {\n            //sang trái\n            case 90:\n                this.side = \"left\";\n                this.rigidBody.setLinearVelocity(new math.Vec3(this.speed, 0, 0));\n                break;\n            // nửa trái\n            case 45:\n                this.side = \"half-left\";\n                this.rigidBody.setLinearVelocity(new math.Vec3(this.speed, 0, this.speed));\n                break;\n            // sang phải\n            case -90:\n                this.side = \"right\";\n                this.rigidBody.setLinearVelocity(new math.Vec3(-this.speed, 0, 0));\n                break;\n            // nửa phải\n            case -45:\n                this.side = \"half-right\";\n                this.rigidBody.setLinearVelocity(new math.Vec3(-this.speed, 0, this.speed));\n                break;\n            // lên trên\n            case 0:\n                this.side = \"up\";\n                this.rigidBody.setLinearVelocity(new math.Vec3(0, 0, this.speed));\n                break;\n            // xuống dưới\n            case 180:\n                this.side = \"down\";\n                this.rigidBody.setLinearVelocity(new math.Vec3(0, 0, -this.speed));\n                break;\n            default:\n                break;\n        }\n    }\n\n\n    public removeRigidbody(): void {\n        this.isCanMove = false;\n        this.rigidBody.enabled = false;\n        this.collider.enabled = false;\n        // this.rigidBody.destroy();\n        // this.collider.destroy();\n    }\n\n\n    private handleGoToTurnPoint(CarStopsComp: CarStops): void {\n        GameInfo.isCanTouch = false;\n\n        this.vFX_smoke.node.active = true;\n\n        let stopPoint: Interface.CarStopsState = CarStopsComp.CarStopsState.find(state => state.state === false);\n        stopPoint.state = true;\n        this.stopID = stopPoint.id;\n\n        let carSkin = this.getComponent(CarSkin);\n        CarStopsComp.updateStopStates(stopPoint, carSkin);\n\n        switch (this.side) {\n            case \"left\":\n                this.targetNode = CarStopsComp.turnRightPoint;\n                // Quat.fromEuler(this.targetQuat, 0, 0, 0);\n\n                tween(this.node)\n                    .to(0.3, { position: CarStopsComp.turnRightPoint.position }, { easing: easing.smooth })\n                    .call(() => this.handleGoToRoadStopPoint(CarStopsComp, stopPoint))\n                    .start();\n\n                break;\n            case \"half-left\":\n                this.targetNode = CarStopsComp.turnRightPoint;\n                // Quat.fromEuler(this.targetQuat, 0, 0, 0);\n\n                tween(this.node)\n                    .to(0.3, { position: CarStopsComp.turnRightPoint.position }, { easing: easing.smooth })\n                    .call(() => this.handleGoToRoadStopPoint(CarStopsComp, stopPoint))\n                    .start();\n                break;\n            case \"right\":\n                this.targetNode = CarStopsComp.turnLeftPoint;\n                // Quat.fromEuler(this.targetQuat, 0, 0, 0);\n\n                tween(this.node)\n                    .to(0.3, { position: CarStopsComp.turnLeftPoint.position }, { easing: easing.smooth })\n                    .call(() => this.handleGoToRoadStopPoint(CarStopsComp, stopPoint))\n                    .start();\n                break;\n            case \"half-right\":\n                this.targetNode = CarStopsComp.turnLeftPoint;\n                // Quat.fromEuler(this.targetQuat, 0, 0, 0);\n                tween(this.node)\n                    .to(0.3, { position: CarStopsComp.turnLeftPoint.position }, { easing: easing.smooth })\n                    .call(() => this.handleGoToRoadStopPoint(CarStopsComp, stopPoint))\n                    .start();\n                break;\n            case \"up\":\n                this.node.setRotationFromEuler(new math.Vec3(0, 0, 0));\n                this.handleGoToRoadStopPoint(CarStopsComp, stopPoint)\n                break;\n            case \"down\":\n                this.targetNode = CarStopsComp.Down_turnleftPoint;\n                // Quat.fromEuler(this.targetQuat, 0, -90, 0);\n\n                tween(this.node)\n                    .to(0.35, { position: CarStopsComp.Down_turnleftPoint.position }, { easing: easing.smooth })\n                    .call(() => {\n                        this.targetNode = CarStopsComp.turnLeftPoint;\n                        // Quat.fromEuler(this.targetQuat, 0, 0, 0);\n\n                        tween(this.node)\n                            .to(0.5, { position: CarStopsComp.turnLeftPoint.position }, { easing: easing.smooth })\n                            .call(() => {\n                                this.handleGoToRoadStopPoint(CarStopsComp, stopPoint);\n                            })\n                            .start();\n                    })\n                    .start();\n                break;\n            default:\n                break;\n        }\n    }\n\n\n    private handleGoToRoadStopPoint(CarStopsComp: CarStops, stopPoint: Interface.CarStopsState): void {\n        this.roadStopsPoint = CarStopsComp.node.getChildByName(`RoadStop_${stopPoint.id}`);\n        this.donePoint = CarStopsComp.donePoint;\n        let stopPointNode: Node = CarStopsComp.CarStops[stopPoint.id - 1];\n\n\n        let euler: number = -90;\n        if (this.side.includes(\"right\")) euler = 90;\n        else if (this.side.includes(\"up\")) {\n            if (stopPoint.id === 1 || stopPoint.id === 2 || stopPoint.id === 3 || stopPoint.id === 4) euler = 90;\n            if (stopPoint.id === 5 || stopPoint.id === 6 || stopPoint.id === 7 || stopPoint.id === 8) euler = -90;\n        }\n\n        this.targetNode = this.roadStopsPoint;\n        Quat.fromEuler(this.targetQuat, 0, euler, 0);\n\n        tween(this.node)\n            .to(0.3, { position: this.roadStopsPoint.position }, { easing: easing.smooth })\n            .call(() => this.handleGoToStopPoint(CarStopsComp, stopPointNode, stopPoint))\n            .start();\n    }\n\n\n    private handleGoToStopPoint(CarStopsComp: CarStops, stopPointNode: Node, stopPoint: Interface.CarStopsState): void {\n        this.targetNode = stopPointNode;\n\n        this.vFX_smoke.node.active = false;\n\n        tween(this.node)\n            .to(0.3, { position: stopPointNode.position }, { easing: easing.smooth })\n            .call(() => {\n                this.targetNode = null;\n                Quat.fromEuler(this.targetQuat, 0, 31, 0);\n                this.getComponent(CarSkin).car_Top.active = false;\n                stopPoint.isReady = true;\n                GameInfo.isCanTouch = true;\n                GameInfo.IsPlaying = true;\n\n                let firstCumtomer = GameInfo.currentCustomers[0].getComponent(CustomerBehavior);\n                let firstCustomerColorID = firstCumtomer.customerColorID;\n\n                if (GameInfo.carStops.every(stop => stop.isReady === true && stop.colorID !== firstCustomerColorID) && GameInfo.IsPlaying) {\n                    GameInfo.isLose = true;\n                }\n            })\n            .start();\n    }\n\n\n    public handleDoneFullCustomer(): void {\n        this.targetNode = null;\n        \n        GameInfo.carStops[this.stopID - 1].carSkin = null;\n        GameInfo.carStops[this.stopID - 1].isReady = false;\n        GameInfo.carStops[this.stopID - 1].state = false;\n        GameInfo.carStops[this.stopID - 1].colorID = null;\n\n        tween(this.node)\n            .to(0.25, { position: this.roadStopsPoint.position }, { easing: easing.smooth })\n            .call(() => gotoDonePoint())\n            .start();\n\n        const gotoDonePoint = () => {\n            this.vFX_smoke.node.active = true;\n            \n            SoundController.Instance(SoundController).PlaySound(CONST.SoundTrack.carMoveToPlace);\n\n            this.node.setRotationFromEuler(new math.Vec3(0, -90, 0));\n            tween(this.node)\n                .to(1, { position: this.donePoint.position }, { easing: easing.smooth })\n                .call(() => {\n                    this.node.active = false;\n                    this.destroy();\n                })\n                .start();\n        }\n    }\n\n\n    private updateRotation(dt: number): void {\n        if (!this.targetNode) return;\n\n        const currentPos = this.node.worldPosition.clone();\n        const targetPos = this.targetNode.worldPosition.clone();\n\n        const direction = new Vec3();\n        Vec3.subtract(direction, targetPos, currentPos);\n        direction.normalize(); // Chuẩn hóa vector\n\n        Quat.fromViewUp(this.targetQuat, direction, Vec3.UP);\n        this.currentQuat = this.node.rotation;\n\n        // Nội suy giữa quaternion hiện tại và quaternion mục tiêu\n        Quat.slerp(this.currentQuat, this.currentQuat, this.targetQuat, 0.1 * dt);\n\n        // Cập nhật góc quay cho Node\n        this.node.setRotation(this.currentQuat);\n    }\n\n\n    protected update(dt: number): void {\n        this.updateRotation(dt);\n\n        this.isCanMove && this.applyforce();\n    }\n}\n\n\n"]}