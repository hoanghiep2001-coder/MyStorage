
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/src/gobang/GobangAI.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '718e4R2i4ZJIo5PjMMgEagd', 'GobangAI');
// src/gobang/GobangAI.ts

Object.defineProperty(exports, "__esModule", { value: true });
exports.GobangAI = void 0;
var GobangConstants_1 = require("./GobangConstants");
var GobangAI = /** @class */ (function () {
    function GobangAI(board) {
        this.board = board;
        this.fiveGroup = []; //五元组
        this.fiveGroupScore = []; //五元组分数
        //添加五元数组
        //横向
        for (var y = 0; y < 15; y++) {
            for (var x = 0; x < 11; x++) {
                this.fiveGroup.push([cc.v2(x, y), cc.v2(x + 1, y), cc.v2(x + 2, y), cc.v2(x + 3, y), cc.v2(x + 4, y)]);
            }
        }
        //纵向
        for (var x = 0; x < 15; x++) {
            for (var y = 0; y < 11; y++) {
                this.fiveGroup.push([cc.v2(x, y), cc.v2(x, y + 1), cc.v2(x, y + 2), cc.v2(x, y + 3), cc.v2(x, y + 4)]);
            }
        }
        //右上斜向
        for (var b = -10; b <= 10; b++) {
            for (var x = 0; x < 11; x++) {
                if (b + x < 0 || b + x > 10) {
                    continue;
                }
                else {
                    this.fiveGroup.push([cc.v2(x, b + x), cc.v2(x + 1, b + x + 1), cc.v2(x + 2, b + x + 2), cc.v2(x + 3, b + x + 3), cc.v2(x + 4, b + x + 4)]);
                }
            }
        }
        //右下斜向
        for (var b = 4; b <= 24; b++) {
            for (var y = 0; y < 11; y++) {
                if (b - y < 4 || b - y > 14) {
                    continue;
                }
                else {
                    this.fiveGroup.push([cc.v2(b - y, y), cc.v2(b - y - 1, y + 1), cc.v2(b - y - 2, y + 2), cc.v2(b - y - 3, y + 3), cc.v2(b - y - 4, y + 4)]);
                }
            }
        }
    }
    GobangAI.prototype.getNextCoor = function () {
        var pieceMap = this.board.pieceMap;
        //评分
        for (var i = 0; i < this.fiveGroup.length; i++) {
            var b = 0; //五元组里黑棋的个数
            var w = 0; //五元组里白棋的个数
            for (var j = 0; j < 5; j++) {
                if (this.board.getPieceByCoor(this.fiveGroup[i][j]).color === GobangConstants_1.BLACK) {
                    b++;
                }
                else if (this.board.getPieceByCoor(this.fiveGroup[i][j]).color === GobangConstants_1.WHITE) {
                    w++;
                }
            }
            if (b + w == 0) {
                this.fiveGroupScore[i] = 7;
            }
            else if (b > 0 && w > 0) {
                this.fiveGroupScore[i] = 0;
            }
            else if (b == 0 && w == 1) {
                this.fiveGroupScore[i] = 35;
            }
            else if (b == 0 && w == 2) {
                this.fiveGroupScore[i] = 800;
            }
            else if (b == 0 && w == 3) {
                this.fiveGroupScore[i] = 15000;
            }
            else if (b == 0 && w == 4) {
                this.fiveGroupScore[i] = 800000;
            }
            else if (w == 0 && b == 1) {
                this.fiveGroupScore[i] = 15;
            }
            else if (w == 0 && b == 2) {
                this.fiveGroupScore[i] = 400;
            }
            else if (w == 0 && b == 3) {
                this.fiveGroupScore[i] = 1800;
            }
            else if (w == 0 && b == 4) {
                this.fiveGroupScore[i] = 100000;
            }
        }
        //找最高分的五元组
        var hScore = 0;
        var mPosition = 0;
        for (var i = 0; i < this.fiveGroupScore.length; i++) {
            if (this.fiveGroupScore[i] > hScore) {
                hScore = this.fiveGroupScore[i];
                mPosition = i;
            }
        }
        //在最高分的五元组里找到最优下子位置
        var flag1 = false; //无子
        var flag2 = false; //有子
        var nPosition = 0;
        for (var i = 0; i < 5; i++) {
            if (!flag1 && this.board.getPieceByCoor(this.fiveGroup[mPosition][i]).color === GobangConstants_1.NONE) {
                nPosition = i;
            }
            if (!flag2 && this.board.getPieceByCoor(this.fiveGroup[mPosition][i]).color !== GobangConstants_1.NONE) {
                flag1 = true;
                flag2 = true;
            }
            if (flag2 && this.board.getPieceByCoor(this.fiveGroup[mPosition][i]).color === GobangConstants_1.NONE) {
                nPosition = i;
                break;
            }
        }
        //在最最优位置下子
        return this.fiveGroup[mPosition][nPosition];
    };
    return GobangAI;
}());
exports.GobangAI = GobangAI;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc3JjXFxnb2JhbmdcXEdvYmFuZ0FJLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EscURBQXVEO0FBRXZEO0lBTUksa0JBQW9CLEtBQWtCO1FBQWxCLFVBQUssR0FBTCxLQUFLLENBQWE7UUFKOUIsY0FBUyxHQUF5QixFQUFFLENBQUMsQ0FBQSxLQUFLO1FBRTFDLG1CQUFjLEdBQWlCLEVBQUUsQ0FBQSxDQUFBLE9BQU87UUFHNUMsUUFBUTtRQUNSLElBQUk7UUFDSixLQUFJLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBQyxDQUFDLEdBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxFQUFDO1lBQ2pCLEtBQUksSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFDLENBQUMsR0FBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLEVBQUM7Z0JBQ2pCLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLEVBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxFQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsRUFBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLEVBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN6RjtTQUNKO1FBQ0QsSUFBSTtRQUNKLEtBQUksSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFDLENBQUMsR0FBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLEVBQUM7WUFDakIsS0FBSSxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUMsQ0FBQyxHQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsRUFBQztnQkFDakIsSUFBSSxDQUFDLFNBQVMs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QUE7QUExR1ksNEJBQVEiLCJmaWxlIjoiIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHb2JhbmdCb2FyZCB9IGZyb20gXCIuL0dvYmFuZ0JvYXJkXCI7XHJcbmltcG9ydCB7IE5PTkUsIEJMQUNLLCBXSElURSB9IGZyb20gXCIuL0dvYmFuZ0NvbnN0YW50c1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEdvYmFuZ0FJIHtcclxuXHJcbiAgICBwcml2YXRlIGZpdmVHcm91cDpBcnJheTxBcnJheTxjYy5WZWMyPj4gPSBbXTsvL+S6lOWFg+e7hFxyXG5cclxuICAgIHByaXZhdGUgZml2ZUdyb3VwU2NvcmU6QXJyYXk8bnVtYmVyPiA9IFtdLy/kupTlhYPnu4TliIbmlbBcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJvYXJkOiBHb2JhbmdCb2FyZCkgeyBcclxuICAgICAgICAvL+a3u+WKoOS6lOWFg+aVsOe7hFxyXG4gICAgICAgIC8v5qiq5ZCRXHJcbiAgICAgICAgZm9yKGxldCB5PTA7eTwxNTt5Kyspe1xyXG4gICAgICAgICAgICBmb3IobGV0IHg9MDt4PDExO3grKyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpdmVHcm91cC5wdXNoKFtjYy52Mih4LHkpLGNjLnYyKHgrMSx5KSxjYy52Mih4KzIseSksY2MudjIoeCszLHkpLGNjLnYyKHgrNCx5KV0pO1xyXG4gICAgICAgICAgICB9ICBcclxuICAgICAgICB9XHJcbiAgICAgICAgLy/nurXlkJFcclxuICAgICAgICBmb3IobGV0IHg9MDt4PDE1O3grKyl7XHJcbiAgICAgICAgICAgIGZvcihsZXQgeT0wO3k8MTE7eSsrKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZml2ZUdyb3VwLnB1c2goW2NjLnYyKHgseSksY2MudjIoeCx5KzEpLGNjLnYyKHgseSsyKSxjYy52Mih4LHkrMyksY2MudjIoeCx5KzQpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy/lj7PkuIrmlpzlkJFcclxuICAgICAgICBmb3IobGV0IGI9LTEwO2I8PTEwO2IrKyl7XHJcbiAgICAgICAgICAgIGZvcihsZXQgeD0wO3g8MTE7eCsrKXtcclxuICAgICAgICAgICAgICAgIGlmKGIreDwwfHxiK3g+MTApe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXZlR3JvdXAucHVzaChbY2MudjIoeCxiK3gpLGNjLnYyKHgrMSxiK3grMSksY2MudjIoeCsyLGIreCsyKSxjYy52Mih4KzMsYit4KzMpLGNjLnYyKHgrNCxiK3grNCldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvL+WPs+S4i+aWnOWQkVxyXG4gICAgICAgIGZvcihsZXQgYj00O2I8PTI0O2IrKyl7XHJcbiAgICAgICAgICAgIGZvcihsZXQgeT0wO3k8MTE7eSsrKXtcclxuICAgICAgICAgICAgICAgIGlmKGIteTw0fHxiLXk+MTQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXZlR3JvdXAucHVzaChbY2MudjIoYi15LHkpLGNjLnYyKGIteS0xLHkrMSksY2MudjIoYi15LTIseSsyKSxjYy52MihiLXktMyx5KzMpLGNjLnYyKGIteS00LHkrNCldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXROZXh0Q29vcigpOmNjLlZlYzIge1xyXG4gICAgICAgIGxldCBwaWVjZU1hcCA9IHRoaXMuYm9hcmQucGllY2VNYXA7ICAgICAgICBcclxuICAgICAgICAvL+ivhOWIhlxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5maXZlR3JvdXAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGIgPSAwOy8v5LqU5YWD57uE6YeM6buR5qOL55qE5Liq5pWwXHJcbiAgICAgICAgICAgIGxldCB3ID0gMDsvL+S6lOWFg+e7hOmHjOeZveaji+eahOS4quaVsFxyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDU7IGorKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmQuZ2V0UGllY2VCeUNvb3IodGhpcy5maXZlR3JvdXBbaV1bal0pLmNvbG9yID09PSBCTEFDSykge1xyXG4gICAgICAgICAgICAgICAgICAgIGIrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5ib2FyZC5nZXRQaWVjZUJ5Q29vcih0aGlzLmZpdmVHcm91cFtpXVtqXSkuY29sb3IgPT09IFdISVRFKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChiICsgdyA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpdmVHcm91cFNjb3JlW2ldID0gNztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChiID4gMCAmJiB3ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXZlR3JvdXBTY29yZVtpXSA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYiA9PSAwICYmIHcgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXZlR3JvdXBTY29yZVtpXSA9IDM1O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGIgPT0gMCAmJiB3ID09IDIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZml2ZUdyb3VwU2NvcmVbaV0gPSA4MDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYiA9PSAwICYmIHcgPT0gMykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXZlR3JvdXBTY29yZVtpXSA9IDE1MDAwO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGIgPT0gMCAmJiB3ID09IDQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZml2ZUdyb3VwU2NvcmVbaV0gPSA4MDAwMDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodyA9PSAwICYmIGIgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXZlR3JvdXBTY29yZVtpXSA9IDE1O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHcgPT0gMCAmJiBiID09IDIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZml2ZUdyb3VwU2NvcmVbaV0gPSA0MDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodyA9PSAwICYmIGIgPT0gMykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXZlR3JvdXBTY29yZVtpXSA9IDE4MDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodyA9PSAwICYmIGIgPT0gNCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXZlR3JvdXBTY29yZVtpXSA9IDEwMDAwMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvL+aJvuacgOmrmOWIhueahOS6lOWFg+e7hFxyXG4gICAgICAgIGxldCBoU2NvcmUgPSAwO1xyXG4gICAgICAgIGxldCBtUG9zaXRpb24gPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5maXZlR3JvdXBTY29yZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5maXZlR3JvdXBTY29yZVtpXSA+IGhTY29yZSkge1xyXG4gICAgICAgICAgICAgICAgaFNjb3JlID0gdGhpcy5maXZlR3JvdXBTY29yZVtpXTtcclxuICAgICAgICAgICAgICAgIG1Qb3NpdGlvbiA9IGk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy/lnKjmnIDpq5jliIbnmoTkupTlhYPnu4Tph4zmib7liLDmnIDkvJjkuIvlrZDkvY3nva5cclxuICAgICAgICBsZXQgZmxhZzEgPSBmYWxzZTsvL+aXoOWtkFxyXG4gICAgICAgIGxldCBmbGFnMiA9IGZhbHNlOy8v5pyJ5a2QXHJcbiAgICAgICAgbGV0IG5Qb3NpdGlvbiA9IDA7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKCFmbGFnMSAmJiB0aGlzLmJvYXJkLmdldFBpZWNlQnlDb29yKHRoaXMuZml2ZUdyb3VwW21Qb3NpdGlvbl1baV0pLmNvbG9yID09PSBOT05FKSB7XHJcbiAgICAgICAgICAgICAgICBuUG9zaXRpb24gPSBpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghZmxhZzIgJiYgdGhpcy5ib2FyZC5nZXRQaWVjZUJ5Q29vcih0aGlzLmZpdmVHcm91cFttUG9zaXRpb25dW2ldKS5jb2xvciAhPT0gTk9ORSkge1xyXG4gICAgICAgICAgICAgICAgZmxhZzEgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgZmxhZzIgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChmbGFnMiAmJiB0aGlzLmJvYXJkLmdldFBpZWNlQnlDb29yKHRoaXMuZml2ZUdyb3VwW21Qb3NpdGlvbl1baV0pLmNvbG9yID09PSBOT05FKSB7XHJcbiAgICAgICAgICAgICAgICBuUG9zaXRpb24gPSBpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy/lnKjmnIDmnIDkvJjkvY3nva7kuIvlrZBcclxuICAgICAgICByZXR1cm4gdGhpcy5maXZlR3JvdXBbbVBvc2l0aW9uXVtuUG9zaXRpb25dO1xyXG4gICAgfVxyXG59Il19