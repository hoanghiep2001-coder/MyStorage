{"version":3,"sources":["assets\\src\\jump\\JumpScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Player } from \"./JumpPlayer\";\r\nimport { Stage } from \"./JumpStage\";\r\nimport { STATE } from \"./JumpConstants\";\r\nimport { Progress } from \"./JumpProgress\";\r\nimport { G } from \"../G\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class JumpScene extends cc.Component {\r\n\r\n    @property(Stage)\r\n    private stage: Stage = null;\r\n    @property(Progress)\r\n    private progress: Progress = null;\r\n    @property(cc.Node)\r\n    private ignoreStoryButton: cc.Node = null;\r\n\r\n    public state: STATE = STATE.NONE;\r\n\r\n    start() {\r\n        this.addListeners();\r\n        this.startGame();\r\n    }\r\n\r\n    private startGame() {\r\n        this.state = STATE.READY;\r\n        this.stage.init(this);\r\n        this.stage.showStartStory(() => {\r\n            this.ignoreStoryButton.active = false;\r\n            this.progress.init(200);\r\n            this.progress.show();\r\n            this.state = STATE.START;\r\n            this.stage.startGame();\r\n        }, this);\r\n    }\r\n\r\n    private overGame(isSuccess: boolean) {\r\n        if (isSuccess) {\r\n            this.progress.hide();\r\n            this.state = STATE.OVER;\r\n            this.stage.endGame(()=>{\r\n                G.gameRoot.showMaskMessage(\"原来我不是男主\",\r\n                {\r\n                    label: \"打扰了\", cb: () => {\r\n                        G.returnHall();\r\n                    }, target: this\r\n                });\r\n            },this);\r\n        } else {\r\n            this.state = STATE.OVER;\r\n            G.gameRoot.showMaskMessage(\"缘已至此\",\r\n                {\r\n                    label: \"放不下\", cb: () => {\r\n                        this.stage.startGame();\r\n                        this.state = STATE.START;\r\n                        this.progress.updateProgress(0);\r\n                    }, target: this\r\n                },\r\n                {\r\n                    label: \"算了吧\", cb: () => {\r\n                        G.returnHall();\r\n                    }, target: this\r\n                });\r\n        }\r\n\r\n    }\r\n\r\n    private onScreenTouchStart() {\r\n        if (this.state === STATE.START) {\r\n            this.stage.playerReadyJump();\r\n        }\r\n    }\r\n\r\n    private onScreenTouchEnd() {\r\n        if (this.state === STATE.START) {\r\n            this.stage.playerJump((playerIndex: number, needNewBlock: boolean) => {\r\n                if (playerIndex === -1) {\r\n                    this.state = STATE.NONE;\r\n                    this.stage.playerDie(()=>{\r\n                        this.overGame(false);\r\n                    },this);\r\n                } else {\r\n                    let isSuccess = this.progress.updateProgress(playerIndex);\r\n                    if (isSuccess) {\r\n                        this.overGame(true);\r\n                    } else {\r\n                        if (needNewBlock) {\r\n                            this.stage.addNewBlock();\r\n                        }\r\n                    }\r\n                }\r\n            }, this);\r\n        }\r\n    }\r\n\r\n    private ignoreStory() {\r\n        this.stage.ignoreStory();\r\n    }\r\n\r\n    private addListeners() {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onScreenTouchStart, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onScreenTouchEnd, this);\r\n    }\r\n\r\n    private removeListeners() {\r\n\r\n    }\r\n\r\n}\r\n"]}